<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Jumping Ball Runner</title>
<style>
:root {
  --bg1:#7bd4ff;
  --bg2:#ffe8f7;
  --ui:rgba(255,255,255,0.7);
  --accent:#ff3e9e;
  --warn:#ff6b6b;
}
html,body{height:100%;margin:0;background:#111;font-family:Arial, sans-serif;color:#111;overflow:hidden;}
#wrap{position:fixed;inset:0;display:grid;place-items:center;}
#gameCanvas{width:100vw;height:100vh;display:block;background:linear-gradient(180deg,var(--bg1),var(--bg2));}
#hud{position:fixed;top:0;left:0;right:0;display:flex;justify-content:space-between;padding:10px 14px;font-weight:700;pointer-events:none;color:#222;}
.pill{background:var(--ui);backdrop-filter:blur(4px);border-radius:999px;padding:6px 12px;margin-right:8px;}
#overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);transition:opacity .3s;}
#overlay.hidden{opacity:0;pointer-events:none;}
.card{background:linear-gradient(180deg,#fff,#fff9);padding:18px;border-radius:16px;box-shadow:0 10px 40px rgba(0,0,0,0.5);text-align:center;}
button{appearance:none;background:linear-gradient(180deg,var(--accent),#ff057e);color:white;border:none;padding:10px 14px;border-radius:12px;font-weight:bold;cursor:pointer;margin:4px;}
button.secondary{background:#ddd;color:#111;}
</style>
</head>
<body>
<div id="wrap">
  <canvas id="gameCanvas"></canvas>
  <div id="hud">
    <div id="scorePill" class="pill">Score: <span id="score">0.0</span></div>
    <div id="highPill" class="pill">High: <span id="high">0.0</span></div>
    <div id="speedPill" class="pill">Speed: <span id="speed">1.0x</span></div>
  </div>
  <div id="overlay">
    <div class="card" id="menuCard">
      <h1>Jumping Ball Runner</h1>
      <p>Dodge the blocks and last as long as you can.</p>
      <button id="startBtn">Start</button>
      <button id="howBtn" class="secondary">How to Play</button>
    </div>
  </div>
</div>
<script>
(function(){
 const canvas = document.getElementById('gameCanvas');
 const ctx = canvas.getContext('2d');
 let DPR = window.devicePixelRatio || 1;
 function resize(){
   DPR = window.devicePixelRatio || 1;
   canvas.width = Math.floor(window.innerWidth*DPR);
   canvas.height = Math.floor(window.innerHeight*DPR);
 }
 window.addEventListener('resize', resize);
 resize();

 // UI
 const scoreEl = document.getElementById('score');
 const highEl = document.getElementById('high');
 const speedEl = document.getElementById('speed');
 const overlay = document.getElementById('overlay');
 const startBtn = document.getElementById('startBtn');
 const howBtn = document.getElementById('howBtn');
 let best = parseFloat(localStorage.getItem('jbr_best') || 0);
 highEl.textContent = best.toFixed(1);

 // game state
 let running=false, gameOver=false, paused=false;
 let score=0, speed=400, speedMul=1;
 let lastTime=0;
 let gravity=2000, jumpVel=-800;
 const player = {x:100,y:0,vy:0,r:25,onGround:false};
 const obstacles=[];
 let spawnTimer=0;

 function resetPlayer(){
   player.r = Math.floor(canvas.height*0.03);
   player.x = Math.floor(canvas.width*0.2);
   player.y = canvas.height*0.8 - player.r;
   player.vy = 0; player.onGround=true;
 }

 function spawnObstacle(){
   const w = (40 + Math.random()*60)*DPR;
   const h = (40 + Math.random()*100)*DPR;
   const y = canvas.height - h;
   const x = canvas.width + w;
   obstacles.push({x,y,w,h});
 }

 function update(dt){
   speedMul += dt*0.04;
   const vel = speed * speedMul;
   speedEl.textContent = speedMul.toFixed(2)+'x';
   // player physics
   player.vy += gravity*dt;
   player.y += player.vy*dt;
   const floorY = canvas.height*0.8;
   if(player.y + player.r >= floorY){
     player.y = floorY - player.r;
     player.vy = 0;
     player.onGround=true;
   }
   // spawn obstacles
   spawnTimer -= dt;
   if(spawnTimer <=0){
     spawnObstacle();
     spawnTimer = 1 + Math.random();
   }
   // move obstacles
   for(let i=0;i<obstacles.length;i++){
     const o = obstacles[i];
     o.x -= vel*dt;
   }
   // remove off-screen
   while(obstacles.length && obstacles[0].x + obstacles[0].w < 0){
     obstacles.shift();
   }
   // collision
   for(const o of obstacles){
     const cx = player.x*DPR;
     const cy = player.y*DPR;
     const r = player.r*DPR;
     const rx = o.x, ry = o.y, rw = o.w, rh = o.h;
     const nearestX = Math.max(rx, Math.min(cx, rx+rw));
     const nearestY = Math.max(ry, Math.min(cy, ry+rh));
     const dx = cx - nearestX;
     const dy = cy - nearestY;
     if(dx*dx + dy*dy <= r*r){
       endGame();
       return;
     }
   }
   // score
   score += dt;
   scoreEl.textContent = score.toFixed(1);
 }

 function draw(){
   ctx.save();
   // clear
   ctx.fillStyle= '#fdf5e6';
   ctx.fillRect(0,0,canvas.width,canvas.height);
   // ground
   ctx.fillStyle='#f0e4d7';
   ctx.fillRect(0,canvas.height*0.8,canvas.width,canvas.height*0.2);
   // obstacles
   ctx.fillStyle='#4b7bec';
   ctx.strokeStyle='#3867d6';
   for(const o of obstacles){
     ctx.fillRect(o.x, o.y, o.w, o.h);
     ctx.strokeRect(o.x, o.y, o.w, o.h);
   }
   // player
   ctx.fillStyle='#eb3b5a';
   ctx.beginPath();
   ctx.arc(player.x*DPR, player.y*DPR, player.r*DPR, 0, Math.PI*2);
   ctx.fill();
   ctx.restore();
 }

 function loop(timestamp){
   if(!running) return;
   const dt = (timestamp - lastTime)/1000;
   lastTime = timestamp;
   update(dt);
   draw();
   requestAnimationFrame(loop);
 }

 function startGame(){
   overlay.classList.add('hidden');
   running=true;
   gameOver=false;
   score=0;
   speedMul=1;
   obstacles.length=0;
   spawnTimer=1;
   resetPlayer();
   lastTime=performance.now();
   requestAnimationFrame(loop);
 }

 function endGame(){
   running=false;
   gameOver=true;
   if(score > best){
     best = score;
     localStorage.setItem('jbr_best', best);
   }
   highEl.textContent = best.toFixed(1);
   overlay.innerHTML = '<div class="card"><h2>Game Over</h2><p>Score: '+score.toFixed(1)+'s<br>High: '+best.toFixed(1)+'s</p><button id="retryBtn">Retry</button><button id="menuBtn" class="secondary">Menu</button></div>';
   overlay.classList.remove('hidden');
   document.getElementById('retryBtn').addEventListener('click', function(){ overlay.classList.add('hidden'); startGame(); });
   document.getElementById('menuBtn').addEventListener('click', function(){ location.reload(); });
 }

 function jump(){
   if(!running || paused) return;
   if(player.onGround){
     player.vy = jumpVel;
     player.onGround=false;
   }
 }

 document.addEventListener('keydown', function(e){
   if(['Space','ArrowUp','KeyW'].includes(e.code)){
     e.preventDefault();
     jump();
   }
 });

 document.addEventListener('pointerdown', function(e){
   jump();
 });

 startBtn.addEventListener('click', function(){
   startGame();
 });

 howBtn.addEventListener('click', function(){
   alert('Tap / Click / Press Space/W/Up arrow to jump.\nAvoid the blocks and survive as long as possible!\nSpeed increases over time.');
 });

})();
</script>
</body>
</html>
